//---------------------------------------------------------------------------

#include <fmx.h>
#include <fstream>
#include <string>
#pragma hdrstop

#include "RegistrationForm.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.fmx"
TMyRegistrationForm *MyRegistrationForm;
//---------------------------------------------------------------------------
__fastcall TMyRegistrationForm::TMyRegistrationForm(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------

const char* convertToCharPtr(AnsiString ansiStr) {
	return ansiStr.c_str() ;
}
bool checkTextEmpty() {
	bool textEmpty = std::strcmp(convertToCharPtr(nameEdit->Text, "")) &&
					 std::strcmp(convertToCharPtr(emailEdit->Text, "")) &&
					 std::strcmp(convertToCharPtr(usernameEdit->Text, "")) &&
					 std::strcmp(convertToCharPtr(passwordEdit->Text, "")) &&
					 std::strcmp(convertToCharPtr(passwordConfirmEdit->Text, "")) ;

	return textEmpty ;
}

void __fastcall TMyRegistrationForm::SaveButtonClick(TObject *Sender)
{
	fstream myFile ;
	myFile.open("registeredUsers.txt", ios::app) ;

	if (checkTextEmpty()) {
		messageLabel->Text = "Please fill out all forms before continuing." ;
	}
	else if (std::strcmp(convertToCharPtr(passwordEdit->Text), convertToCharPtr(passwordConfirmEdit->Text)) != 0) {
		messageLabel->Text = "Passwords do not match. Please reenter and try again." ;
	}
	else {
		if (myFile.is_open()) {
			AnsiString name = nameEdit->Text ;
			AnsiString email = emailEdit->Text ;
			AnsiString username = usernameEdit->Text ;
			AnsiString password = passwordEdit->Text ;

			myFile << name << "," << email << "," << username << "," << password << "\n" ;
			myFile.close() ;
			messageLabel->Text = "User registered successfully!" ;
		}
	}

	myFile.close() ;
}
//---------------------------------------------------------------------------

